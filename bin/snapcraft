#!/usr/bin/python3
# -*- Mode:Python; indent-tabs-mode:t; tab-width:4 -*-

import argparse
import os
import sys

sys.path.append(os.path.abspath(os.path.join(__file__, "..", "..")))
import snapcraft.cmds

root_parser = argparse.ArgumentParser()
subparsers = root_parser.add_subparsers(dest='cmd')

# Parent parsers

cmd_parser = argparse.ArgumentParser(add_help=False)
cmd_parser.add_argument('--force', action='store_true', help='redo all steps for all parts')
cmd_parser.add_argument('part', nargs='*')

# Command parsers

parser = subparsers.add_parser('init', help='start a project')
parser.add_argument('part', nargs='*')
parser.set_defaults(func=snapcraft.cmds.init)

parser = subparsers.add_parser('pull', help='get sources', parents=[cmd_parser])
parser.set_defaults(func=snapcraft.cmds.allOthers)

parser = subparsers.add_parser('build', help='build parts', parents=[cmd_parser])
parser.set_defaults(func=snapcraft.cmds.allOthers)

parser = subparsers.add_parser('stage', help='put parts into staging area', parents=[cmd_parser])
parser.set_defaults(func=snapcraft.cmds.allOthers)

parser = subparsers.add_parser('snap', help='put parts into snap area', parents=[cmd_parser], aliases=['all'])
parser.set_defaults(func=snapcraft.cmds.allOthers)

args = root_parser.parse_args()

if not hasattr(args, 'func'):
	root_parser.print_help()
	sys.exit(1)

args.func(args)
sys.exit(0)
